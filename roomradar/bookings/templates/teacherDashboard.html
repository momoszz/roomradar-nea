{% load booking_filters %}
<!DOCTYPE html>
<html>
<head>
    <title>Teacher Dashboard - RoomRadar</title>
    <style>
        body {font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; display: flex;}
        /* sidebar styling */
        .sidebar {width: 250px; background: white; padding: 20px; border-radius: 8px; margin-right: 20px; border: 1px solid #ddd; height: fit-content;}
        .sidebar h2 {font-size: 18px; margin-top: 0; border-bottom: 2px solid #007bff; padding-bottom: 10px; color: #333;}
        .upcoming-list {list-style: none; padding: 0; margin: 0;}
        .upcoming-item {padding: 10px 0; border-bottom: 1px solid #eee; font-size: 14px;}
        .upcoming-item:last-child {border-bottom: none;}
        .upcoming-date {font-weight: bold; color: #333;}
        .upcoming-details {color: #666; margin-top: 4px; font-size: 13px;}
        .empty-list {color: #999; font-style: italic; padding: 10px 0; font-size: 14px;}

        /* main content styling */
        .main-content {flex: 1;}
        .header {background: #007bff; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;}
        h1 {margin: 0; font-size: 24px;}
        .week-nav {margin-top: 15px; display: flex; align-items: center;}
        .week-btn {color: white; text-decoration: none; padding: 6px 12px; border: 1px solid rgba(255,255,255,0.5); border-radius: 4px; font-size: 14px; margin-right: 15px; transition: background 0.2s;}
        .week-btn:hover {background: rgba(255,255,255,0.1);}
        .week-info {font-size: 16px; font-weight: bold;}

        .filter-section {margin-bottom: 20px; display: flex; align-items: center;}
        .filter-section label {font-weight: bold; margin-right: 10px; color: #555;}
        select {padding: 8px; border-radius: 4px; border: 1px solid #ddd; font-size: 14px; min-width: 200px;}

        .room-section {background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ddd;}
        .room-header {padding-bottom: 10px; margin-bottom: 15px; border-bottom: 1px solid #eee;}
        .room-name {font-size: 20px; font-weight: bold; color: #333;}
        .room-details {color: #666; font-size: 13px; margin-top: 5px;}

        table {width: 100%; border-collapse: collapse; margin-top: 10px;}
        th {background: #f8f9fa; padding: 12px 8px; text-align: center; border: 1px solid #dee2e6; font-weight: 600; font-size: 14px;}
        td {padding: 0; text-align: center; border: 1px solid #dee2e6; height: 50px; font-size: 14px;}

        /* cell states */
        .period-cell {font-weight: bold; background: #f8f9fa; width: 60px;}

        .available {background: #d4edda; color: #155724;}
        .available a {display: flex; width: 100%; height: 50px; text-decoration: none; color: inherit; align-items: center; justify-content: center; transition: background 0.2s;}
        .available a:hover {background: #c3e6cb;}

        .booked {background: #dc3545; color: white; font-weight: bold; vertical-align: middle;}

        .my-booking {background: #28a745; color: white; font-weight: bold;}
        .my-booking a {display: flex; width: 100%; height: 50px; text-decoration: none; color: white; align-items: center; justify-content: center;}
        .my-booking a:hover {background: #218838;}

        .no-rooms {background: white; padding: 40px; text-align: center; border-radius: 8px; color: #666; border: 1px solid #ddd;}
    </style>
</head>
<body>
    <div class='sidebar'>
        <h2>My Upcoming Bookings</h2>
        {% if upcomingBookings %}
            <ul class='upcoming-list'>
                {% for booking in upcomingBookings %}
                    <li class='upcoming-item'>
                        <div class='upcoming-date'>{{ booking.bookingDate|date:'D, d M' }} - Period {{ booking.periodNumber }}</div>
                        <div class='upcoming-details'>{{ booking.room.roomName }} - {{ booking.className }}</div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class='empty-list'>No upcoming bookings found.</div>
        {% endif %}
    </div>

    <div class='main-content'>
        <div class='header'>
            <h1>Welcome, {{ username }}</h1>
            <div class='week-nav'>
                <a href='?offset={{ prevOffset }}{% if currentRoomId %}&room={{ currentRoomId }}{% endif %}' class='week-btn'>&larr; Previous Week</a>
                <span class='week-info'>{{ weekStart|date:'d M Y' }} - {{ weekEnd|date:'d M Y' }}</span>
                <a href='?offset={{ nextOffset }}{% if currentRoomId %}&room={{ currentRoomId }}{% endif %}' class='week-btn'>Next Week &rarr;</a>
            </div>
        </div>

        <div class='filter-section'>
            <form method='GET'>
                <input type='hidden' name='offset' value='{{ weekOffset }}'>
                <label for='roomSelect'>Filter by Room: </label>
                <select name='room' id='roomSelect' onchange='this.form.submit()'>
                    <option value=''>All Rooms</option>
                    {% for r in allRooms %}
                        <option value='{{ r.id }}' {% if r.id == currentRoomId %}selected{% endif %}>{{ r.roomName }}</option>
                    {% endfor %}
                </select>
            </form>
        </div>

        {% if rooms %}
            {% for room in rooms %}
                <div class='room-section'>
                    <div class='room-header'>
                        <div class='room-name'>{{ room.roomName }}</div>
                        <div class='room-details'>
                            Capacity: {{ room.capacity }} |
                            Block: {{ room.blockLocation }} |
                            Projector: {% if room.hasProjector %}Yes{% else %}No{% endif %} |
                            Computers: {% if room.hasComputers %}Yes{% else %}No{% endif %}
                        </div>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Period</th>
                                {% for day in weekdays %}
                                    <th>{{ day.name }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for period in periods %}
                                <tr>
                                    <td class='period-cell'>P{{ period }}</td>
                                    {% for day in weekdays %}
                                        {% get_booking bookingLookup room.id period day.number as booking %}
                                        {% if booking %}
                                            {% if booking.teacher.username == username %}
                                                <td class='my-booking'>
                                                    <a href='{% url "editBooking" booking.bookingID %}'>My Class</a>
                                                </td>
                                            {% else %}
                                                <td class='booked'>Booked</td>
                                            {% endif %}
                                        {% else %}
                                            <td class='available'>
                                                <a href='{% url "bookRoom" room.id period weekStart|add_days:day.number|date:"Y-m-d" %}'>
                                                    Book
                                                </a>
                                            </td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endfor %}
        {% else %}
            <div class='no-rooms'>
                <h2>No Rooms Found</h2>
                <p>Try changing your filter settings or contact an administrator.</p>
            </div>
        {% endif %}
    </div>
</body>
</html>
